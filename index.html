<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8" />
  <title>QR Scanner Alati</title>
  <script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #reader { width: 300px; margin-bottom: 20px; }
    #result { border: 1px solid #ccc; padding: 10px; max-width: 600px; }
    img { max-width: 100px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>QR Scanner za alate</h1>

  <div id="reader"></div>
  <div id="result">Skeniraj QR kod da vidiš detalje alata.</div>

  <script>
    const SHEET_URL = 'https://script.google.com/macros/s/AKfycbxISLSuUi8FuPQObh-Z7OeYGoMOXAO066xpt9MCC0vbiTl8OiGVdKtuQp4vbVu3PETJVA/exec';
    let alatData = [];

    // Učitaj podatke iz Google Sheets API-ja
    function loadSheetData() {
      return fetch(SHEET_URL)
        .then(res => res.json())
        .then(data => {
          alatData = data;
          console.log('Podaci učitani:', alatData.length);
        })
        .catch(err => {
          console.error('Greška u dohvaćanju podataka:', err);
          document.getElementById('result').innerText = 'Greška u dohvaćanju podataka.';
        });
    }

    // Pronađi alat po ID-u i prikaži informacije
    function prikaziAlat(id) {
      const alat = alatData.find(a => a.id == id);
      const rez = document.getElementById('result');
      if (!alat) {
        rez.innerHTML = `<p style="color:red;">Alat nije pronađen (ID: ${id})</p>`;
        return;
      }
      rez.innerHTML = `
        <h2>${alat.naziv}</h2>
        <p><strong>Šifra:</strong> ${alat.sifra}</p>
        <p><strong>Cijena:</strong> ${alat.cijena} kn</p>
        <p><strong>Cijena s rabatom:</strong> ${alat.cijena_rabat} kn</p>
        ${alat.slika ? `<img src="${alat.slika}" alt="${alat.naziv}">` : ''}
        <p>${alat.opis || ''}</p>
      `;
    }

    // Inicijaliziraj QR skener
    function initScanner() {
      const html5QrCode = new Html5Qrcode("reader");
      const qrConfig = { fps: 10, qrbox: 250 };

      html5QrCode.start(
        { facingMode: "environment" },
        qrConfig,
        qrCodeMessage => {
          console.log(`Skeniran QR kod: ${qrCodeMessage}`);
          prikaziAlat(qrCodeMessage.trim());
          html5QrCode.stop(); // zaustavi skeniranje nakon prvog čitanja
        },
        errorMessage => {
          // možeš ispisivati greške skeniranja ako želiš
          // console.warn(`QR scan error: ${errorMessage}`);
        }
      ).catch(err => {
        console.error('Ne mogu pokrenuti skener:', err);
        document.getElementById('result').innerText = 'Nema pristupa kameri.';
      });
    }

    // Glavni tok
    loadSheetData().then(() => {
      initScanner();
    });
  </script>
</body>
</html>
